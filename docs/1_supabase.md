# Mode 1: Building from Scratch with Supabase (No Backend)

Use this mode when starting a new project where the backend doesn't exist yet. You'll develop the frontend with a temporary Supabase backend, then generate an OpenAPI specification for the backend team to use as a reference.

---

# Setup

**Initialize project in Bolt**: http://bolt.new/github.com/poviolabs/bolt-template

**Configure Bolt's Package Knowledge**

To ensure Bolt follows our conventions, add these package rules to your team's Packages knowledge:

| Package Name | Package Prompt |
|--------------|----------------|
| `@povio/ui` | `rules/povio-ui-rules.md` |
| `@tanstack/react-query` | `rules/react-query-rules.md` |
| `@tanstack/react-router` | `rules/tanstack-router-rules.md` |
| `clsx` | `rules/clsx-rules.md` |
| `lucide-react` | `rules/lucide-rules.md` |
| `tailwindcss` | `rules/tailwind-rules.md` |
| `react-hook-form` | `rules/react-hook-form-rules.md` |

---

# Common Issues

These are common pitfalls and bugs you might encounter. Click to jump to detailed explanations:

1. **[Newly added pages not working](#routing)** - AI creates a folder with the same name as an existing route file
2. **[Submitting a form does nothing](#forms)** - Required data appended during submission causes validation errors
3. **[OpenAPI spec generation exceeded token limit](#data-layer)** - Exceeding token limits when generating large specs

---

# Prompting

For general prompting tips, AI model selection, and planning mode, see the **[Prompting Guide](./3_prompting.md)**.

## First Prompt

Give a rough overview of the app and tell it to only implement user authentication in the first prompt:

```
Build me an app named ... which will have the features ... Start with the user authentication - add a login and register page. Logged in users should be redirected to... 
```

Bolt should handle the Supabase and auth context provider setup automatically and add new data layer code. Make sure it did this step correctly (check Authentication section).

---

# Rules & Possible Pitfalls

## Routing

Routing is done via [Tanstack React Router](https://tanstack.com/router/latest/docs/framework/react/overview). The template comes with two pre-defined route groups:

- `(private)` - Routes that require the user to be logged in
- `(public-only)` - Routes that require the user to NOT be logged in (e.g. login)
- Adding routes outside of these two folders makes them public - accessible by all users
- The guard logic of the groups can be modified in their corresponding `route.tsx` files

**Possible bug:** if the AI agent creates a new folder inside pages with the same name as an existing route component, one of these routes will not be generated by Tanstack Router. Example:

```
src/pages/
├── posts/
│   ├── create.tsx
│   └── $postId.tsx
├── posts.tsx // Either this route or the nested posts routes will not be generated
└── index.ts

--- Solution: ---

src/pages/
├── posts/
│   ├── index.tsx // Moved inside folder and renamed to index.tsx
│   ├── create.tsx
│   └── $postId.tsx
└── index.ts

```

## Data Layer

**During Development:**
- All data operations go through `data/` folder
- Supabase provides real-time backend functionality
- Data structure:
  ```
  data/
  └── posts/
      ├── posts.queries.ts   # React Query hooks
      └── posts.models.ts    # Zod schemas
  ```

**Generating OpenAPI Spec:**

Once your data model is stable and finished, ask Bolt:

```
Generate an OpenAPI specification based on the current data layer. 
Follow the rules in `rules/openapi-rules.md`
```

This creates an `openapi.json` file that the backend team can use as reference. You can verify the spec by running `npm run openapi:gen` and see if the Codegen CLI can parse it.

**NOTE:** if your data layer is large, ask Bolt to generate it in parts with multiple prompts, otherwise it will exceed a prompt token limit and not give you any result. Try sticking to max 5 modules per prompt. If it still exceeds a limit when adding new modules to the spec, explicitly tell it to modify the existing file instead of creating a new one.

## Authentication

- Bolt should set up Supabase Auth automatically when implementing authentication
- Make sure Bolt correctly updates all the necessary files:
   - `src/providers/auth.provider.tsx` switch from mock implementation to Supabase logic
   - `src/hooks/useAuth` correct user type
- The auth provider will need to be switched to JWT provider when migrating to Backend

## Forms

Bolt should by default use either `useForm` or `useFormAutosave` from `@povio/ui`, which uses `react-hook-form` behind the scenes. 

Validation is done through the `zodSchema` parameter, where Bolt passes the appropriate Zod schema from `src/data/*.models.ts`.

**Possible bug:** if some required data only gets appended **during the form submission**, the form validation can fail and your onSubmit handler will not trigger. To avoid this, make sure that all required data in the Zod schema is actually added to the form hook's state.

## File Upload

- Ask Bolt to implement file upload for your use case
- It will create its own bucket and integrate it with Supabase
- This logic will need to be updated when migrating to Backend

---

# Publish Prototype App

- Inside the Bolt project, click "Publish" on the top right
- Bolt will give you a URL to the published app
- You must re-publish the app manually after making changes (app URL stays the same)

---

# Moving to Monorepo

When moving from Bolt to the monorepo:

1. **Export Project**
   - Click on the chat/project name on top left
   - Export > Download

2. **Override Monorepo Frontend App**
   - Replace the entire content of `apps/fe` with the exported project
   - Copy `turbo.json` from admin app
   - Copy and replace `.oxlintrc.json` from admin app
   - Copy and replace `tsconfig.json` from admin app
      - Remove `tsconfig.app.json` and `tsconfig.node.json` from within fe
   - Copy and replace `biome.json` from admin app
   - Copy and replace `.vscode/settings.json` from admin app
      - Remove `.vscode/extensions.json` from within fe
   - Copy and replace `.gitignore` and `.gitattributes` from admin app
   - Remove `.bolt` folder

3. **Update scripts in package.json**
   - Switch to zx scripts - refer to admin app. Example:
      ```json
      {
         "scripts": {
            "dev": "zx scripts/execute.mjs dev",
            "build": "zx scripts/execute.mjs build",
            "clean": "rimraf .turbo out src/openapi",
            "lint": "oxlint --type-aware . --fix",
            "lint:check": "oxlint --type-aware . --quiet",
            "format": "biome check --write .",
            "format:check": "biome check .",
            "typecheck": "tsgo --noEmit",
            "generate": "zx scripts/execute.mjs generate",
            "script": "zx scripts/execute.mjs --",
            "openapi:gen": "openapi-codegen generate --prettier false",
            "openapi:check": "openapi-codegen check",
            "svg": "npx @svgr/cli --config-file ./svg/.svgrrc.js -- svg/icons && biome format --write ./src/assets/icons",
            "i18n:missing": "npx tsx scripts/i18n/find-missing-translations.ts"
         }
      }
      ```

4. **Update environment variables in .config**
   - Set backend API URL:
      - `dev.spa.template.yml`: "http://localhost:4000/"
      - `local.spa.template.yml` "http://localhost:4000/"
      - `monorepo-dev.spa.template.yml` (deployment): "https://api.dev.pov.io/" (Put your actual deployed app's URL)
   - Add Supabase variables in all 3 files:
      - VITE_SUPABASE_URL: ""
      - VITE_SUPABASE_ANON_KEY: ""
      - Take values from the .env file that Bolt generated
      - Can be commited - they are publicly visible and will be removed after backend migration
   - Add any additional environment variables (analytics, sentry, etc.)

5. **UI Updates**
   - Change @povio/ui dependency from npm to local package
      ```json
      {
         "dependencies": {
            "@povio/ui": "workspace:*"
         }
      }
      ```
   - Change Tailwind source inside `globals.css` to point to the local UI package 
      ```css
      @source "../../../../packages/ui/src";
      ```
   - Remove `scripts/copy-ui-source.mjs`
   - Remove `.povio-ui-source`

6. **Migration to Backend**
   - Update `openapi-codegen.config.ts` OpenAPI spec input path
      ```ts
      const config: OpenAPICodegenConfig = {
         input: "../be/resources/openapi-main.json",
         /// ...
      }
      ```
   - Generate data layer:
     ```bash
     yarn generate
     ```
   - Update authentication to use `jwt.provider.ts`
      - Uncomment and update `refresh-token-interceptor.ts`
      - Update `jwt.provider.ts` to use the correct user fetching function if different
      - Update `main.tsx` to use JWTProvider instead of SupabaseAuthProvider
   - Update all usages of React Query hooks and Zod models to their corresponding ones in `src/openapi`
      - Migrate all file upload logic to the backend's system
   - Remove old Supabase code - when whole app is migrated
      - Remove `migrations` and `data` folders
      - Remove `src/lib/supabase.ts`
      - Remove "@supabase/supabase-js" package
      - Remove Supabase env variables from `app.config.ts` and `.config/*.template.yml` files
